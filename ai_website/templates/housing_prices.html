{% extends "base.html" %}

{% block title %}Housing Price Prediction - Ryan Thompson{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1 class="page-title">Housing Price Prediction</h1>
        <p class="page-subtitle">Use a simple machine learning model to estimate home prices from key features.</p>
    </div>
</section>

<section class="handwriting-demo">
    <div class="container">
        <div class="demo-container">
            <div class="demo-card">
                <div class="demo-header">
                    <h3>Enter Home Details</h3>
                    <p>Fill in the fields and click Predict to estimate the price.</p>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-home"></i> Property</h3>
                        <ul>
                            <li>Square footage includes finished living space.</li>
                            <li>Bathrooms accept half baths (e.g., 1.5).</li>
                            <li>Year built should be a four-digit year.</li>
                        </ul>
                    </div>
                    <div class="info-card">
                        <h3><i class="fas fa-lightbulb"></i> Tip</h3>
                        <ul>
                            <li>Numbers are normalized internally for the model.</li>
                            <li>Prediction is illustrative and not market advice.</li>
                        </ul>
                    </div>
                </div>

                <div class="interactive-demo" style="margin-top:1rem;">
                    <div class="parameter-controls">
                        <label>Square Feet:<input type="number" id="sqftInput" min="200" max="10000" value="1800" step="10"></label>
                        <label>Bedrooms:<input type="number" id="bedroomsInput" min="0" max="10" value="3" step="1"></label>
                        <label>Bathrooms:<input type="number" id="bathroomsInput" min="0" max="10" value="2" step="0.5"></label>
                        <label>Year Built:<input type="number" id="yearBuiltInput" min="1900" max="2025" value="2005" step="1"></label>
                    </div>
                    <div class="demo-controls">
                        <button class="btn btn-primary" id="predictBtn"><i class="fas fa-calculator"></i> Predict Price</button>
                        <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-undo"></i> Reset</button>
                    </div>
                </div>

                <div class="demo-result" id="priceResult">
                    <div class="prediction-main">
                        <h4>Predicted Price</h4>
                        <div class="predicted-digit" id="predictedPrice">—</div>
                        <div class="confidence-score" id="echoInputs"></div>
                    </div>
                </div>

                <div class="demo-info">
                    <div class="tips-grid">
                        <div class="tip-item"><i class="fas fa-chart-line"></i><span>Model retrains on synthetic data at startup for demonstration purposes.</span></div>
                        <div class="tip-item"><i class="fas fa-balance-scale"></i><span>Standardization helps linear models handle different feature scales.</span></div>
                        <div class="tip-item"><i class="fas fa-exclamation-circle"></i><span>Estimates are educational and may not reflect real market conditions.</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Utility to format currency.
function formatUSD(value) { try { return new Intl.NumberFormat('en-US', {style: 'currency', currency: 'USD', maximumFractionDigits: 0}).format(value); } catch (e) { return `$${Math.round(value).toLocaleString()}`; } }

// Read inputs safely.
function readInputs() { const sqft = parseFloat(document.getElementById('sqftInput').value); const bedrooms = parseFloat(document.getElementById('bedroomsInput').value); const bathrooms = parseFloat(document.getElementById('bathroomsInput').value); const year_built = parseFloat(document.getElementById('yearBuiltInput').value); return {sqft, bedrooms, bathrooms, year_built}; }

// Basic validation to avoid NaNs.
function validateInputs(data) { return Number.isFinite(data.sqft) && Number.isFinite(data.bedrooms) && Number.isFinite(data.bathrooms) && Number.isFinite(data.year_built); }

// Set loading state.
function setLoading(isLoading) { const res = document.getElementById('priceResult'); const price = document.getElementById('predictedPrice'); const echo = document.getElementById('echoInputs'); if (isLoading) { res.classList.add('loading'); price.textContent = 'Estimating…'; echo.textContent = ''; } else { res.classList.remove('loading'); } }

// Show result or error.
function showResult(prediction, inputs) { const res = document.getElementById('priceResult'); const price = document.getElementById('predictedPrice'); const echo = document.getElementById('echoInputs'); res.classList.remove('error'); res.classList.add('success'); price.textContent = formatUSD(prediction); echo.textContent = `${inputs.bedrooms} bd · ${inputs.bathrooms} ba · ${Math.round(inputs.sqft)} sqft · built ${Math.round(inputs.year_built)}`; }

function showError(message) { const res = document.getElementById('priceResult'); const price = document.getElementById('predictedPrice'); const echo = document.getElementById('echoInputs'); res.classList.remove('success'); res.classList.add('error'); price.textContent = 'Error'; echo.textContent = message; }

// Predict handler.
async function onPredict() { const data = readInputs(); if (!validateInputs(data)) { showError('Please provide valid numeric inputs.'); return; } setLoading(true); try { const response = await fetch('/api/house-price', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)}); const json = await response.json(); if (!response.ok || json.error) { throw new Error(json.error || `Request failed (${response.status}).`); } showResult(json.prediction, json.inputs); } catch (e) { showError(e.message || 'Prediction failed.'); } finally { setLoading(false); } }

// Reset handler.
function onReset() { document.getElementById('sqftInput').value = 1800; document.getElementById('bedroomsInput').value = 3; document.getElementById('bathroomsInput').value = 2; document.getElementById('yearBuiltInput').value = 2005; document.getElementById('predictedPrice').textContent = '—'; document.getElementById('echoInputs').textContent = ''; const res = document.getElementById('priceResult'); res.classList.remove('success'); res.classList.remove('error'); }

// Wire up events.
document.addEventListener('DOMContentLoaded', function() { document.getElementById('predictBtn').addEventListener('click', onPredict); document.getElementById('resetBtn').addEventListener('click', onReset); });
</script>
{% endblock %}
