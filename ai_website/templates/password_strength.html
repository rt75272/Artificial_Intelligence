{% extends "base.html" %}

{% block title %}Password Strength - Ryan Thompson{% endblock %}

{% block content %}
<section class="page-header">
  <div class="container">
    <h1 class="page-title">Password Strength Predictor</h1>
    <p class="page-subtitle">Use machine learning to evaluate password strength.</p>
  </div>
</section>

<section class="info-section">
  <div class="container">
    <h2>How it works</h2>
    <p>
      This demo uses a Random Forest classifier trained on password features to predict strength.
      Features include length, character diversity (lowercase, uppercase, digits, special chars), and uniqueness.
    </p>
    <h3>Strength levels</h3>
    <ul>
      <li><strong>Weak:</strong> Short passwords with limited character types.</li>
      <li><strong>Medium:</strong> Moderate length with some character diversity.</li>
      <li><strong>Strong:</strong> Long passwords with high character diversity and uniqueness.</li>
    </ul>
  </div>
  <style>
  .info-section{padding:1rem 0 .5rem}
  .info-section h2{margin-bottom:.5rem}
  .info-section h3{margin-top:.75rem}
  .info-section ul{margin-left:1.25rem}
  </style>
</section>

<section class="demo-section">
  <div class="container">
    <div class="controls">
      <input id="password" type="text" placeholder="Enter password" style="padding:0.5rem;font-size:1rem;width:300px">
      <button id="predictBtn" class="btn btn-primary">Check Strength</button>
    </div>
    <div class="generate-section">
      <button id="generateBtn" class="btn btn-success" style="font-size:1.1rem;padding:0.75rem 1.5rem;font-weight:bold">üîê Generate Secure Password</button>
      <label style="margin-left:0.75rem">Length: <input id="length" type="number" min="4" max="64" value="12" style="width:60px;padding:0.4rem"></label>
    </div>
    <div class="result">
      <div>Strength: <span id="strength" style="font-weight:bold">‚Äî</span></div>
      <div id="features" style="font-size:0.9rem;color:#6b7280;margin-top:0.5rem"></div>
      <div id="score" style="font-size:0.9rem;color:#6b7280"></div>
    </div>
  </div>
</section>

<style>
.controls{display:flex;gap:.5rem;justify-content:center;margin-bottom:1rem;flex-wrap:wrap}
.generate-section{display:flex;gap:.5rem;justify-content:center;margin-bottom:1rem;align-items:center;padding:1rem;background:#f0fdf4;border-radius:8px;border:2px dashed #10b981}
.result{text-align:center;font-size:1.25rem;margin-top:1rem}
</style>

<script>
// Password strength client.
const password=document.getElementById('password');
const predictBtn=document.getElementById('predictBtn');
const generateBtn=document.getElementById('generateBtn');
const length=document.getElementById('length');
const strengthSpan=document.getElementById('strength');
const featuresDiv=document.getElementById('features');
const scoreDiv=document.getElementById('score');

predictBtn.addEventListener('click', async()=>{
  try{
    const pwd=password.value;
    if(!pwd){strengthSpan.textContent='‚Äî';featuresDiv.textContent='';scoreDiv.textContent='';return;}
    const res=await fetch('/api/password-strength',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'predict',password:pwd})});
    const data=await res.json();
    if(data.strength){
      const color=data.strength==='weak'?'#ef4444':data.strength==='medium'?'#f59e0b':'#10b981';
      strengthSpan.textContent=data.strength.toUpperCase();
      strengthSpan.style.color=color;
      const f=data.features;
      featuresDiv.textContent=`Length: ${f.length}, Lower: ${f.has_lower}, Upper: ${f.has_upper}, Digit: ${f.has_digit}, Special: ${f.has_special}, Unique: ${f.unique_chars}`;
      scoreDiv.textContent=`Score: ${data.score}/7`;
    }else{strengthSpan.textContent='‚Äî';featuresDiv.textContent='';scoreDiv.textContent='';}
  }catch(e){console.error('Prediction failed.',e);}
});

generateBtn.addEventListener('click', async()=>{
  try{
    const len=parseInt(length.value||'12',10);
    const res=await fetch('/api/password-strength',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'generate',length:len})});
    const data=await res.json();
    if(data.password){password.value=data.password;predictBtn.click();}
  }catch(e){console.error('Generation failed.',e);}
});

// Allow Enter key to predict.
password.addEventListener('keyup',e=>{if(e.key==='Enter')predictBtn.click();});
</script>

{% endblock %}
