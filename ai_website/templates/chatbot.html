{% extends "base.html" %}

{% block title %}AI Chatbot - Ryan Thompson{% endblock %}

{% block content %}
<section class="page-header">
  <div class="container">
    <h1 class="page-title">AI Chatbot</h1>
    <p class="page-subtitle">Chat with a rule-based conversational AI.</p>
  </div>
</section>

<section class="info-section">
  <div class="container">
    <h2>How it works</h2>
    <p>
      This chatbot uses rule-based natural language processing with pattern matching and regular expressions.
      It recognizes common patterns in your messages and responds with predefined answers.
    </p>
    <h3>Try asking about:</h3>
    <ul>
      <li>Greetings: "Hello", "Hi", "Hey"</li>
      <li>AI topics: "What is machine learning?", "Tell me about neural networks"</li>
      <li>Python programming</li>
      <li>Or just have a casual conversation!</li>
    </ul>
  </div>
  <style>
  .info-section{padding:1rem 0 .5rem}
  .info-section h2{margin-bottom:.5rem}
  .info-section h3{margin-top:.75rem}
  .info-section ul{margin-left:1.25rem}
  </style>
</section>

<section class="demo-section">
  <div class="container">
    <div class="chat-container">
      <div id="chatMessages" class="chat-messages"></div>
      <div class="chat-input-container">
        <input id="userInput" type="text" placeholder="Type your message..." class="chat-input">
        <button id="sendBtn" class="btn btn-primary">Send</button>
      </div>
    </div>
  </div>
</section>

<style>
.chat-container{max-width:700px;margin:0 auto;border:2px solid #e5e7eb;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.chat-messages{height:400px;overflow-y:auto;padding:1rem;background:#f9fafb;display:flex;flex-direction:column;gap:.75rem}
.chat-input-container{display:flex;gap:.5rem;padding:1rem;background:#fff;border-top:1px solid #e5e7eb}
.chat-input{flex:1;padding:0.75rem;font-size:1rem;border:1px solid #d1d5db;border-radius:6px}
.chat-input:focus{outline:none;border-color:#3b82f6}
.message{padding:0.75rem 1rem;border-radius:12px;max-width:75%;word-wrap:break-word;animation:fadeIn .3s ease-in}
.user-message{background:#3b82f6;color:#fff;align-self:flex-end;border-bottom-right-radius:4px}
.bot-message{background:#fff;color:#1f2937;align-self:flex-start;border:1px solid #e5e7eb;border-bottom-left-radius:4px}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>

<script>
// Chatbot client.
const chatMessages=document.getElementById('chatMessages');
const userInput=document.getElementById('userInput');
const sendBtn=document.getElementById('sendBtn');

function addMessage(text,isUser){ // Add message bubble to chat.
  const msg=document.createElement('div');
  msg.className=`message ${isUser?'user-message':'bot-message'}`;
  msg.textContent=text;
  chatMessages.appendChild(msg);
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

async function sendMessage(){ // Send user message and get bot response.
  const text=userInput.value.trim();
  if(!text){return;}
  addMessage(text,true);
  userInput.value='';
  try{
    const res=await fetch('/api/chatbot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text})});
    const data=await res.json();
    if(data.response){
      setTimeout(()=>addMessage(data.response,false),500);
    }else{
      addMessage('Sorry, I encountered an error.',false);
    }
  }catch(e){
    console.error('Chat failed.',e);
    addMessage('Sorry, I could not connect.',false);
  }
}

sendBtn.addEventListener('click',sendMessage);
userInput.addEventListener('keyup',e=>{if(e.key==='Enter')sendMessage();});

// Initial greeting.
setTimeout(()=>addMessage('Hello! I\'m an AI chatbot. Ask me about machine learning, Python, or just say hi!',false),500);
</script>

{% endblock %}
